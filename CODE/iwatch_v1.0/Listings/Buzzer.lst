C51 COMPILER V9.52.0.0   BUZZER                                                            06/27/2021 08:52:20 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE BUZZER
OBJECT MODULE PLACED IN ..\Objects\Buzzer.obj
COMPILER INVOKED BY: E:\install_files\keil\C51\BIN\C51.EXE ..\User\System\Buzzer.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR
                    -(..\User\oled;..\User\rtc;..\User\System;..\User;..\User\bluetooth;..\User\radio;..\User\sensor) DEBUG OBJECTEXTEND PRIN
                    -T(..\Listings\Buzzer.lst) TABS(2) OBJECT(..\Objects\Buzzer.obj)

line level    source

   1          #include "Buzzer.h"
   2          #include "stc8a.h"
   3          
   4          
   5          sbit buzzer = P2^6;     //和V1.1设计相同，无需修改
   6          
   7          #define BUZZER_FQ 4000     //蜂鸣器的谐振频率为4khz
   8          #define Focs  24000000     //系统频率为24mhz
   9          #define Fdiv  1            //PWM计数器分频系数
  10          #define PWM_CNT (Focs / (BUZZER_FQ *Fdiv))
  11          #define PWM_duty   0.5
  12          
  13          bit bee_en = 0;
  14          unsigned char bee_mode = 0;
  15          unsigned int bee_time = 0;
  16          
  17          
  18          void BuzzerInit(void)
  19          {
  20   1        P_SW2 |= 0x80;        //P_SW2为外设端口寄存器2，访问特殊功能寄存器前，需要先将P_SW2(BAH)寄存器的最高位置1
  21   1        //设置PWM的频率
  22   1        PWMCKS = 0x00;        //PWM计数器时钟为系统时钟的1分频
  23   1        PWMC = PWM_CNT;        //设置PWM计数器
  24   1        //使能PWM引脚
  25   1        PWM6CR = 0x80;
  26   1        //设置PWM占空比；
  27   1        PWM6T1 = 0x0000;
  28   1        PWM6T2 = (unsigned int )(PWM_CNT * PWM_duty);
  29   1        //PWMCR = 0x80;      //PWM计数器开始计数
  30   1        P_SW2 &= ~0x80;
  31   1      
  32   1        T4T3M |= 0x20 ;        //定时器时钟1T模式
  33   1        T4L = 0x40;          //设置定时初值
  34   1        T4H = 0xA2;           //设置定时初值
  35   1        IE2 |= ET4; 
  36   1        bee_en = 0;
  37   1      }
  38          void BuzzerOnOff(unsigned char b)
  39          {
  40   1        P_SW2 |= 0x80;
  41   1        if(b == 1)
  42   1        {
  43   2          PWMCR |= 0x80;   //计数器开始计数
  44   2        }
  45   1        else
  46   1        {
  47   2          PWMCR &= ~0x80;   //计数器停止计数
  48   2          buzzer = 0;
  49   2        }
  50   1        P_SW2 &= ~0x80;
  51   1      }
  52          void TM4_Isr()   interrupt 20 using 1
  53          {
C51 COMPILER V9.52.0.0   BUZZER                                                            06/27/2021 08:52:20 PAGE 2   

  54   1        AUXINTIF &= ~T4IF;   //清中断标志
  55   1        if(bee_mode == 0)
  56   1        {
  57   2          if(bee_time == 200)
  58   2          {
  59   3            bee_time = 0;
  60   3            BuzzerOnOff(0);
  61   3            T4T3M &= ~0x80;
  62   3          }
  63   2        }
  64   1        else if(bee_mode == 1) 
  65   1        {
  66   2          if(bee_time < 600)
  67   2          {
  68   3            if(bee_time % 100 ==0)
  69   3            {
  70   4              BuzzerOnOff(((bee_time / 100) % 2 ) ^ 0x01);
  71   4              P20 = ((bee_time / 100 ) % 2);
  72   4            }
  73   3          }
  74   2          if(bee_time == 1000)
  75   2          {
  76   3            bee_time = 0;
  77   3          }
  78   2        }
  79   1      }
  80          void Bee(void)
  81          {
  82   1        bee_mode = 0;
  83   1        bee_time = 0;
  84   1        if(bee_en)
  85   1        {
  86   2          BuzzerOnOff(1);
  87   2          T4T3M |= 0x80;
  88   2        }
  89   1      }
  90          void Beebeebee(void)
  91          {
  92   1        bee_mode = 1;
  93   1        bee_time = 0;
  94   1        //BuzzerOnOff(1);
  95   1        T4T3M |= 0x80;
  96   1      }
  97          void EnableBuzzer(unsigned char k)
  98          {
  99   1        if(k)
 100   1          bee_en = 1;
 101   1        else 
 102   1          bee_en = 0;
 103   1      }
 104          
 105          
 106          
 107          
 108          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    276    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      3    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.52.0.0   BUZZER                                                            06/27/2021 08:52:20 PAGE 3   

   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
