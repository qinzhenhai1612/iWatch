C51 COMPILER V9.52.0.0   OLED                                                              06/15/2021 23:47:19 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE OLED
OBJECT MODULE PLACED IN ..\Objects\oled.obj
COMPILER INVOKED BY: E:\install_files\keil\C51\BIN\C51.EXE ..\User\System\oled.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(.
                    -.\User\System;..\User\Sensor;..\User\Rtc;..\User\Radio;..\User\Oled;..\User\Bluetooth;..\User) DEBUG OBJECTEXTEND PRINT(
                    -..\Listings\oled.lst) TABS(2) OBJECT(..\Objects\oled.obj)

line level    source

   1          #include "oled.h"
   2          
   3          //OLED的显存，存放格式如下
   4          //[0]0 1 2 3 ... 127
   5          //[1]0 1 2 3 ... 127
   6          //[2]0 1 2 3 ... 127
   7          //[3]0 1 2 3 ... 127
   8          //[4]0 1 2 3 ... 127
   9          //[5]0 1 2 3 ... 127
  10          //[6]0 1 2 3 ... 127
  11          //[7]0 1 2 3 ... 127
  12          void delay_ms(unsigned int ms)   //24.000MHZ
  13          {
  14   1        unsigned char i , j;
  15   1        for(ms;ms>0;ms--)
  16   1        {
  17   2          i = 24;
  18   2          j = 85;
  19   2          do
  20   2          {
  21   3            while(--j);
  22   3          } while(--i);
  23   2        }
  24   1      }
  25          
  26          #if OLED_MODE == 1
  27          //向SSD1106中写入一个字符
  28          //dat:要写入的数据/命令
  29          //cmd:数据命令标志 0：表示命令，1：表示数据
  30          void OLED_WR_Byte(u8 dat,u8 cmd)
  31          {
  32   1        //OLED_RD_Set();
  33   1        if(cmd)
  34   1          OLED_DC_Set();
  35   1        else
  36   1          OLED_DC_Clr();
  37   1        OLED_WR_Clr();
  38   1        OLED_DAT = dat;
  39   1        OLED_WR_Set();
  40   1        //OLED_DC_Set();
  41   1      }
  42          #else
              //向SSD1306中写入一个字节
              //dat:要写入的数据/命令
              //cmd:数据命令标志 0：表示命令，1：表示数据
              void OLED_WR_Byte(u8 dat,u8 cmd)
              {
                u8 i;
                if(cmd)
                  OLED_DC_Set();
                else
                  OLED_DC_Clr();
                OLED_CS_Clr();
C51 COMPILER V9.52.0.0   OLED                                                              06/15/2021 23:47:19 PAGE 2   

                for(i=0;i<8;i++)
                {
                  OLED_SCLK_Clr();
                  if(dat&0x80)
                  {
                    OLED_SDIN_Set();
                  }
                  else
                    OLED_SDIN_Clr();
                  OLED_SCLK_Set();
                  dat<<=1;
                }
                OLED_CS_Set();
                OLED_DC_Set();
              }
              #endif
  70          void OLED_Set_Pos(unsigned char x,unsigned char y)
  71          {
  72   1        OLED_WR_Byte(0xb0 + y,OLED_CMD);
  73   1        OLED_WR_Byte(((x & 0xf0) >> 4)| 0x10,OLED_CMD);
  74   1        OLED_WR_Byte((x & 0x0f),OLED_CMD);
  75   1        
  76   1      }
  77          //开启OLED显示
  78          void OLED_Display_On(void)
  79          {
  80   1        OLED_WR_Byte(0x8D,OLED_CMD);    //SET DCDC 命令
  81   1        OLED_WR_Byte(0x14,OLED_CMD);    //DCDC ON
  82   1        OLED_WR_Byte(0xAF,OLED_CMD);    //Display on
  83   1      }
  84          //关闭OLED显示
  85          void OLED_Display_Off(void)
  86          {
  87   1        OLED_WR_Byte(0X8D, OLED_CMD);  //SET DCDC命令
  88   1        OLED_WR_Byte(0X10, OLED_CMD);  //DCDC OFF
  89   1        OLED_WR_Byte(0XAE, OLED_CMD);  //DISPLAY OFF
  90   1      }
  91          void OLED_Set_Brightness(unsigned char brightness)   //设置对比度(亮度)
  92          {
  93   1        OLED_WR_Byte(0x81, OLED_CMD);       //--set contrast control register
  94   1        OLED_WR_Byte(brightness, OLED_CMD); // Set SEG Output Current Brightness
  95   1      }
  96          
  97          void OLED_Horizental_Reverse(unsigned char reverse) //水平翻转
  98          {
  99   1        if(reverse)
 100   1          OLED_WR_Byte(0xA0, OLED_CMD);
 101   1        else
 102   1          OLED_WR_Byte(0xA1, OLED_CMD);
 103   1      }
 104          void OLED_Vertical_Reverse(unsigned char reverse)   //垂直翻转
 105          {
 106   1        if(reverse)
 107   1          OLED_WR_Byte(0xC0, OLED_CMD);
 108   1        else
 109   1          OLED_WR_Byte(0xC8, OLED_CMD);
 110   1      }
 111          
 112          void OLED_Inverse(unsigned char k)                  //反色
 113          {
 114   1        if(k)
 115   1          OLED_WR_Byte(0xA7, OLED_CMD);
C51 COMPILER V9.52.0.0   OLED                                                              06/15/2021 23:47:19 PAGE 3   

 116   1        else
 117   1          OLED_WR_Byte(0xA6, OLED_CMD);
 118   1      }
 119          void OLED_Clear(void)   //清屏
 120          {  
 121   1        u8 i,n;       
 122   1        for(i=0;i<8;i++)  
 123   1        {  
 124   2          OLED_WR_Byte (0xb0+i,OLED_CMD);    //设置页地址（0~7）
 125   2          OLED_WR_Byte (0x02,OLED_CMD);      //设置显示位置―列低地址
 126   2          OLED_WR_Byte (0x10,OLED_CMD);      //设置显示位置―列高地址   
 127   2          for(n = 0; n < 128; n++)
 128   2            OLED_WR_Byte(0,OLED_DATA); 
 129   2        }
 130   1      }
 131          void OLED_DrawBMP(unsigned char *buf)
 132          {
 133   1        unsigned char data i, j;
 134   1        unsigned int data n;  
 135   1        for(i = 0; i < 8; i++)  
 136   1        {
 137   2          OLED_WR_Byte(0xb0 + i, OLED_CMD);
 138   2          OLED_WR_Byte(0x10, OLED_CMD);
 139   2          OLED_WR_Byte(0x00, OLED_CMD); 
 140   2          n = i * 128;
 141   2          for(j = 0; j < 128; j++)
 142   2            OLED_WR_Byte(buf[n + j], OLED_DATA); 
 143   2        }
 144   1      }
 145          
 146          //初始化SSD1315             
 147          void OLED_Init()
 148          {
 149   1        OLED_RST_Set();
 150   1        delay_ms(20);
 151   1        OLED_RST_Clr();
 152   1        delay_ms(10);
 153   1        OLED_RST_Set(); 
 154   1        OLED_RD_Set();
 155   1        OLED_WR_Byte(0xAE,OLED_CMD);//--turn off oled panel
 156   1        OLED_WR_Byte(0x02,OLED_CMD);//---set low column address
 157   1        OLED_WR_Byte(0x10,OLED_CMD);//---set high column address
 158   1        OLED_WR_Byte(0x40,OLED_CMD);//--set start line address  Set Mapping RAM Display Start Line (0x00~0x3F)
 159   1        OLED_WR_Byte(0x81,OLED_CMD);//--set contrast control register
 160   1        OLED_WR_Byte(0x7f,OLED_CMD);// Set SEG Output Current Brightness
 161   1        OLED_WR_Byte(0xC8,OLED_CMD);
 162   1        OLED_WR_Byte(0xA1,OLED_CMD);
 163   1        OLED_WR_Byte(0xA8,OLED_CMD);//--set multiplex ratio(1 to 64)
 164   1        OLED_WR_Byte(0x3F,OLED_CMD);//--1/64 duty
 165   1        OLED_WR_Byte(0xD3,OLED_CMD);//-set display offset Shift Mapping RAM Counter (0x00~0x3F)
 166   1        OLED_WR_Byte(0x00,OLED_CMD);//-not offset
 167   1        OLED_WR_Byte(0xd5,OLED_CMD);//--set display clock divide ratio/oscillator frequency
 168   1        OLED_WR_Byte(0x80,OLED_CMD);//--set divide ratio, Set Clock as 100 Frames/Sec
 169   1        OLED_WR_Byte(0xD9,OLED_CMD);//--set pre-charge period
 170   1        OLED_WR_Byte(0xF1,OLED_CMD);//Set Pre-Charge as 15 Clocks & Discharge as 1 Clock
 171   1        OLED_WR_Byte(0xDA,OLED_CMD);//--set com pins hardware configuration
 172   1        OLED_WR_Byte(0x12,OLED_CMD);
 173   1        OLED_WR_Byte(0xDB,OLED_CMD);//--set vcomh
 174   1        OLED_WR_Byte(0x40,OLED_CMD);//Set VCOM Deselect Level
 175   1        OLED_WR_Byte(0x20,OLED_CMD);//-Set Page Addressing Mode (0x00/0x01/0x02)
 176   1        OLED_WR_Byte(0x02,OLED_CMD);//
 177   1        OLED_WR_Byte(0x8D,OLED_CMD);//--set Charge Pump enable/disable
C51 COMPILER V9.52.0.0   OLED                                                              06/15/2021 23:47:19 PAGE 4   

 178   1        OLED_WR_Byte(0x14,OLED_CMD);//--set(0x10) disable
 179   1        OLED_WR_Byte(0xA4,OLED_CMD);// Disable Entire Display On (0xa4/0xa5)
 180   1        OLED_WR_Byte(0xA6,OLED_CMD);// Disable Inverse Display On (0xa6/a7) 
 181   1        OLED_WR_Byte(0xAF,OLED_CMD);//--turn on oled panel
 182   1        //OLED_WR_Byte(0xD6,OLED_CMD);
 183   1        //OLED_WR_Byte(0x01,OLED_CMD);
 184   1        //OLED_WR_Byte(0x23,OLED_CMD);
 185   1        //OLED_WR_Byte(0x30,OLED_CMD);
 186   1        
 187   1        OLED_WR_Byte(0xAF,OLED_CMD); /*display ON*/ 
 188   1        OLED_Clear();
 189   1        OLED_Set_Pos(0,0);  
 190   1      }  
 191          
 192          
 193          
 194          
 195          
 196          
 197          
 198          
 199          
 200          
 201          
 202          
 203          
 204          
 205          
 206          
 207          
 208          
 209          
 210          
 211          
 212          
 213          
 214          
 215          
 216          
 217          
 218          
 219          
 220          
 221          
 222          
 223          
 224          
 225          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    441    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
